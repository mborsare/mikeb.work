<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Netflix US AtoZ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #000000;
      --text: #c0c0c0;
      --stamp: #888888;
      --seal: #eaffea;
      --btn-fill: color-mix(in hsl, var(--bg), var(--seal) 20%);
    }

    html {
      font-size: 14px;
    }

    @font-face {
      font-family: 'ComicMono';
      src: url('/fonts/ComicMono-Regular.woff') format('woff');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
      font-family: 'ComicMono', monospace;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .container {
      max-width: 72rem;
      width: 100%;
      padding: 1.5rem;
      text-align: center;
    }

    h1 {
      color: var(--seal);
      letter-spacing: .15em;
      margin: 0 0 .25rem 0;
      font-size: 1.6rem;
    }

    .meta {
      opacity: .7;
      font-size: .85rem;
      margin: 0 0 1.25rem 0;
    }

    .controls {
      display: flex;
      align-items: center;
      margin: 0 auto 1rem auto;
      max-width: 64rem;
    }

    input[type="text"] {
      background: transparent;
      border: 2px solid var(--stamp);
      color: var(--text);
      padding: .75rem .9rem;
      border-radius: .9rem;
      font-family: inherit;
      width: 100%;
      outline: none;
    }

    .filters {
      display: flex;
      margin: 1em;
      gap: .75rem;
      white-space: nowrap;
    }

    /* ---- ALPHABET ---- */
    .alphabet {
      display: flex;
      gap: .5rem;
      justify-content: center;
      flex-wrap: wrap;
      margin: 0 auto 1rem auto;
      max-width: 64rem;
    }

    .alphabet button {
      background: transparent;
      border: 1px solid var(--stamp);
      color: var(--text);
      font-family: inherit;
      font-size: .85rem;
      padding: .25rem .5rem;
      border-radius: .4rem;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .alphabet button:hover {
      border-color: var(--seal);
      color: var(--seal);
    }

    .alphabet button.active {
      background: var(--seal);
      color: var(--bg);
      border-color: var(--seal);
    }

    /* ---- MODE SWITCH ---- */
    .mode-switch {
      display: flex;
      align-items: center;
      gap: .6rem;
      margin: .25rem auto 0 auto;
      max-width: 64rem;
      font-size: .85rem;
      justify-content: flex-start;
    }

    .mode-switch input[type="checkbox"] {
      cursor: pointer;
      width: 1rem;
      height: 1rem;
      accent-color: #0375ff;
    }

    .mode-switch label {
      cursor: pointer;
    }

    /* ---- LOADING PULSE ---- */
    body.is-loading #catalog {
      animation: pulse 1.2s ease-in-out infinite;
    }

    @keyframes pulse {
      0% {
        opacity: .35;
      }

      50% {
        opacity: .65;
      }

      100% {
        opacity: .35;
      }
    }

    #count {
      opacity: .75;
      font-size: .85rem;
      margin: .5rem 0 0 0;
    }

    .catalog {
      margin-top: 1.25rem;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(18rem, 1fr));
      gap: .5rem;
      text-align: left;
    }

    .item {
      display: grid;
      grid-template-columns: 3.5rem 1fr;
      gap: .6rem;
      padding: .55rem .75rem;
      border: 1px dotted color-mix(in srgb, var(--stamp), transparent 20%);
      border-radius: .85rem;
      text-decoration: none;
      color: inherit;
      position: relative;
    }

    .item .cover-wrap {
      position: relative;
    }

    .cover {
      width: 100%;
      aspect-ratio: 2 / 3;
      object-fit: cover;
      border-radius: .4rem;
      background: #111;
      transition: opacity 0.2s ease;
    }

    .item:hover .cover {
      opacity: 0.3;
    }

    .play-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--seal);
      font-size: 1rem;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.2s ease;
      pointer-events: none;
    }

    .item:hover .play-overlay {
      opacity: 1;
    }

    .title {
      color: var(--seal);
      line-height: 1.25;
    }

    .sub {
      opacity: .65;
      margin-top: .2rem;
      font-size: .85rem;
    }

    .synopsis {
      margin-top: .35rem;
      font-size: .8rem;
      line-height: 1.35;
      opacity: .6;
    }

    .pill {
      display: inline-block;
      padding: .05rem .45rem;
      border: 1px solid color-mix(in srgb, var(--stamp), transparent 15%);
      border-radius: 999px;
      margin-left: .35rem;
      font-size: .75rem;
      opacity: .85;
    }

    /* ---------- BIG MODE ---------- */
    body.big-mode .catalog {
      grid-template-columns: repeat(auto-fill, minmax(14rem, 1fr));
      gap: 1.25rem;
    }

    body.big-mode .item {
      display: block;
      padding: 0;
      border: none;
    }

    body.big-mode .cover {
      border-radius: .75rem;
    }

    body.big-mode .item>div {
      padding: .5rem .25rem 0 .25rem;
    }
  </style>
</head>

<body class="is-loading">
  <div class="container">
    <nav style="padding: 5em; text-align: center;">
      <a href="/" style="color: var(--seal)">Back</a>
    </nav>

    <h1>NETFLIX US A–Z</h1>
    <div class="meta" id="snapshot">Fixing Netflix, one sec…</div>

    <div class="controls">
      <input id="search" type="text" placeholder="Search titles…" oninput="applyFilters()" autocomplete="off" />
      <div class="filters">
        <label><input type="checkbox" id="filter-movie" checked onchange="applyFilters()" /> Movies</label>
        <label><input type="checkbox" id="filter-series" checked onchange="applyFilters()" /> Series</label>
      </div>
    </div>

    <div class="alphabet" id="alphabet"></div>

    <div class="mode-switch">
      <input type="checkbox" id="mode-big" />
      <label for="mode-big">Make the pictures really big</label>
    </div>

    <div id="count"></div>
    <div class="catalog" id="catalog"></div>
  </div>

  <script>
    const DATA_URL = 'https://netflix.mborsare.workers.dev/';
    const snapshotEl = document.getElementById('snapshot');
    const catalogEl = document.getElementById('catalog');
    const modeCheckbox = document.getElementById('mode-big');
    const searchInput = document.getElementById('search');
    const alphabetEl = document.getElementById('alphabet');

    const loadingTimer = setTimeout(() => {
      if (snapshotEl.textContent === 'Fixing Netflix, one sec…') {
        snapshotEl.textContent = "Still fixing. It's really messy...";
      }
    }, 3000);

    let allTitles = [];
    let usingDummy = false;

    // Create alphabet buttons
    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
    alphabetEl.innerHTML = letters.map(letter =>
      `<button data-letter="${letter}">${letter}</button>`
    ).join('');

    alphabetEl.addEventListener('click', (e) => {
      if (e.target.tagName === 'BUTTON') {
        const letter = e.target.dataset.letter;

        // Remove active class from all buttons
        alphabetEl.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));

        // Add active class to clicked button
        e.target.classList.add('active');

        // Set search input and filter
        searchInput.value = letter;
        applyFilters();
      }
    });

    // Clear active state when user types
    searchInput.addEventListener('input', () => {
      alphabetEl.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
    });

    function normalizeFromWorker(results) {
      return results.map(item => ({
        title: item.title,
        type: item.title_type === 'movie' ? 'movie' : 'series',
        year: item.title_date || item.year || 'N/A',
        rating: item.rating || '',
        netflix_id: item.netflix_id,
        img: item.img || null,
        synopsis: item.synopsis || ''
      }));
    }

    async function loadCatalog() {
      try {
        const res = await fetch(DATA_URL, { cache: 'no-store' });
        if (!res.ok) throw new Error();

        const data = await res.json();
        if (!Array.isArray(data.results)) throw new Error();

        clearTimeout(loadingTimer);
        document.body.classList.remove('is-loading');

        allTitles = normalizeFromWorker(data.results);
        snapshotEl.textContent = `Snapshot: ${data.day} · ${allTitles.length} titles`;
        applyFilters();

      } catch {
        clearTimeout(loadingTimer);
        document.body.classList.remove('is-loading');

        snapshotEl.textContent = 'Snapshot: dummy data';
        allTitles = [];
        applyFilters();
      }
    }

    function applyFilters() {
      const q = document.getElementById('search').value.toLowerCase();
      const showMovies = document.getElementById('filter-movie').checked;
      const showSeries = document.getElementById('filter-series').checked;

      const filtered = allTitles.filter(t =>
        (!q || t.title.toLowerCase().includes(q)) &&
        ((t.type === 'movie' && showMovies) || (t.type === 'series' && showSeries))
      ).sort((a, b) => a.title.localeCompare(b.title, 'en', { sensitivity: 'base' }));

      document.getElementById('count').textContent = `${filtered.length} titles`;
      catalogEl.innerHTML = filtered.map(t => `
        <a class="item" href="${t.netflix_id ? `https://www.netflix.com/watch/${t.netflix_id}` : '#'}" target="_blank">
          ${t.img ? `
            <div class="cover-wrap">
              <img class="cover" src="${t.img}" loading="lazy">
              <div class="play-overlay">PLAY ></div>
            </div>
          ` : ''}
          <div>
            <div class="title">${escapeHtml(t.title)}</div>
            <div class="sub">${t.year} <span class="pill">${t.type}</span></div>
            ${t.synopsis ? `<div class="synopsis">${escapeHtml(t.synopsis)}</div>` : ''}
          </div>
        </a>
      `).join('');
    }

    modeCheckbox.addEventListener('change', () => {
      const on = modeCheckbox.checked;
      document.body.classList.toggle('big-mode', on);
      localStorage.setItem('viewMode', on ? 'big' : 'small');
    });

    if (localStorage.getItem('viewMode') === 'big') {
      modeCheckbox.checked = true;
      document.body.classList.add('big-mode');
    }

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, c => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
      }[c]));
    }

    loadCatalog();
  </script>
</body>

</html>