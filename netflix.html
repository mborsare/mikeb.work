<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Netflix US AtoZ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #000000;
      --text: #c0c0c0;
      --stamp: #888888;
      --seal: #eaffea;
      --btn-fill: color-mix(in hsl, var(--bg), var(--seal) 20%);
    }

    html {
      font-size: 14px;
    }

    @font-face {
      font-family: 'ComicMono';
      src: url('/fonts/ComicMono-Regular.woff') format('woff');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
      font-family: 'ComicMono', monospace;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .container {
      max-width: 72rem;
      width: 100%;
      padding: 1.5rem;
      text-align: center;
    }

    h1 {
      color: var(--seal);
      letter-spacing: .15em;
      margin: 0 0 .25rem 0;
      font-size: 1.6rem;
    }

    .meta {
      opacity: .7;
      font-size: .85rem;
      margin: 0 0 1.25rem 0;
    }

    .controls {
      display: flex;
      align-items: center;
      margin: 0 auto 1rem auto;
      max-width: 64rem;
    }

    input[type="text"] {
      background: transparent;
      border: 2px solid var(--stamp);
      color: var(--text);
      padding: .75rem .9rem;
      border-radius: .9rem;
      font-family: inherit;
      width: 100%;
      outline: none;
    }

    .filters {
      display: flex;
      margin: 1em;
      gap: .75rem;
      white-space: nowrap;
    }

    /* ---- ALPHABET (STICKY) ---- */
    .alphabet {
      position: sticky;
      top: 0;
      z-index: 5;
      display: flex;
      gap: .5rem;
      justify-content: center;
      flex-wrap: wrap;
      margin: 0 auto 1rem auto;
      max-width: 64rem;
      background: var(--bg);
      padding: .5rem 0 .75rem;
      border-bottom: 1px dotted color-mix(in srgb, var(--stamp), transparent 40%);
    }

    .alphabet button {
      background: transparent;
      border: 1px solid var(--stamp);
      color: var(--text);
      font-family: inherit;
      font-size: .85rem;
      padding: .25rem .5rem;
      border-radius: .4rem;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .alphabet button:hover {
      border-color: var(--seal);
      color: var(--seal);
    }

    .alphabet button:active {
      background: var(--seal);
      color: var(--bg);
      border-color: var(--seal);
    }

    .alphabet button.random {
      background: var(--seal);
      color: var(--bg);
      border-color: var(--seal);
      padding: .25rem .75rem;
    }

    .alphabet button.random:hover {
      opacity: 0.85;
    }

    .mode-switch {
      display: flex;
      align-items: center;
      gap: .6rem;
      margin: .25rem auto 0 auto;
      max-width: 64rem;
      font-size: .85rem;
      justify-content: flex-start;
    }

    .mode-switch input[type="checkbox"] {
      cursor: pointer;
      width: 1rem;
      height: 1rem;
      accent-color: #0375ff;
    }

    .mode-switch label {
      cursor: pointer;
    }

    .nerd-mode {
      display: flex;
      align-items: center;
      gap: .6rem;
      margin: .75rem auto 0 auto;
      max-width: 64rem;
      font-size: .85rem;
      justify-content: flex-start;
      padding: .75rem;
      border: 1px dashed color-mix(in srgb, var(--seal), transparent 50%);
      border-radius: .75rem;
      background: color-mix(in srgb, var(--seal), transparent 95%);
    }

    .nerd-mode input[type="checkbox"] {
      cursor: pointer;
      width: 1rem;
      height: 1rem;
      accent-color: var(--seal);
    }

    .nerd-mode label {
      cursor: pointer;
      color: var(--seal);
    }

    .nerd-mode .time-flavor {
      margin-left: auto;
      font-size: .75rem;
      opacity: .7;
    }

    body.is-loading #catalog {
      animation: pulse 1.2s ease-in-out infinite;
    }

    @keyframes pulse {
      0% {
        opacity: .35;
      }

      50% {
        opacity: .65;
      }

      100% {
        opacity: .35;
      }
    }

    #count {
      opacity: .75;
      font-size: .85rem;
      margin: .5rem 0 0 0;
    }

    .catalog {
      margin-top: 1.25rem;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(18rem, 1fr));
      gap: .5rem;
      text-align: left;
    }

    .item {
      display: grid;
      grid-template-columns: 3.5rem 1fr;
      gap: .6rem;
      padding: .55rem .75rem;
      border: 1px dotted color-mix(in srgb, var(--stamp), transparent 20%);
      border-radius: .85rem;
      text-decoration: none;
      color: inherit;
      position: relative;
    }

    .item .cover-wrap {
      position: relative;
    }

    .cover {
      width: 100%;
      aspect-ratio: 2 / 3;
      object-fit: cover;
      border-radius: .4rem;
      background: #111;
      transition: opacity 0.2s ease;
    }

    .item:hover .cover {
      opacity: 0.3;
    }

    .play-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--seal);
      font-size: 1rem;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.2s ease;
      pointer-events: none;
    }

    .item:hover .play-overlay {
      opacity: 1;
    }

    .title {
      color: var(--seal);
      line-height: 1.25;
    }

    .sub {
      opacity: .65;
      margin-top: .2rem;
      font-size: .85rem;
    }

    .synopsis {
      margin-top: .35rem;
      font-size: .8rem;
      line-height: 1.35;
      opacity: .6;
    }

    .pill {
      display: inline-block;
      padding: .05rem .45rem;
      border: 1px solid color-mix(in srgb, var(--stamp), transparent 15%);
      border-radius: 999px;
      margin-left: .35rem;
      font-size: .75rem;
      opacity: .85;
    }

    body.big-mode .catalog {
      grid-template-columns: repeat(auto-fill, minmax(14rem, 1fr));
      gap: 1.25rem;
    }

    body.big-mode .item {
      display: block;
      padding: 0;
      border: none;
    }

    body.big-mode .cover {
      border-radius: .75rem;
    }

    body.big-mode .item>div {
      padding: .5rem .25rem 0 .25rem;
    }
  </style>
</head>

<body class="is-loading">
  <div class="container">
    <nav style="padding: 5em; text-align: center;">
      <a href="/" style="color: var(--seal)">Back</a>
    </nav>

    <h1>NETFLIX US Aâ€“Z</h1>
    <div class="meta" id="snapshot">Fixing Netflix, one secâ€¦</div>

    <div class="controls">
      <input id="search" type="text" placeholder="Search titlesâ€¦" oninput="applyFilters()" autocomplete="off" />
      <div class="filters">
        <label><input type="checkbox" id="filter-movie" checked onchange="applyFilters()" /> Movies</label>
        <label><input type="checkbox" id="filter-series" checked onchange="applyFilters()" /> Series</label>
      </div>
    </div>

    <div class="alphabet" id="alphabet"></div>

    <div class="mode-switch">
      <input type="checkbox" id="mode-big" />
      <label for="mode-big">Make the pictures really big</label>
    </div>

    <div class="nerd-mode">
      <input type="checkbox" id="nerd-mode" onchange="applyFilters()" />
      <div style="display: flex; flex-direction: column;">
        <label for="nerd-mode">ðŸŽ¬ Nerdy Video Store Mode</label>
        <span class="time-flavor" id="time-flavor"></span>
      </div>
    </div>

    <div id="count"></div>
    <div class="catalog" id="catalog"></div>
  </div>

  <script>
    const DATA_URL = 'https://netflix.mborsare.workers.dev/';
    const snapshotEl = document.getElementById('snapshot');
    const catalogEl = document.getElementById('catalog');
    const modeCheckbox = document.getElementById('mode-big');
    const alphabetEl = document.getElementById('alphabet');
    const timeFlavorEl = document.getElementById('time-flavor');

    let allTitles = [];

    // Nerdy video store keywords and patterns
    const NERD_CRITERIA = {
      // Directors (auteurs)
      directors: ['kubrick', 'lynch', 'carpenter', 'cronenberg', 'argento', 'romero', 'hooper',
        'nolan', 'fincher', 'villeneuve', 'del toro', 'tarantino', 'coen', 'hitchcock',
        'wes anderson', 'paul thomas anderson', 'scorsese', 'ridley scott', 'verhoeven',
        'gilliam', 'zemeckis', 'spielberg', 'cameron'],

      // 80s classics & cult
      classics: ['blade runner', 'alien', 'aliens', 'terminator', 'thing', 'fly', 'evil dead',
        'reanimator', 'hellraiser', 'scanners', 'videodrome', 'they live', 'escape from',
        'big trouble', 'brazil', 'dune', 'tron', 'akira', 'ghost in the shell'],

      // Horror & thriller
      horror: ['nightmare', 'friday the 13th', 'halloween', 'scream', 'saw', 'conjuring',
        'insidious', 'sinister', 'hereditary', 'midsommar', 'witch', 'lighthouse',
        'suspiria', 'cabin', 'descent', 'ring', 'grudge', 'dark', 'black mirror'],

      // Adventure & sci-fi
      adventure: ['indiana jones', 'goonies', 'princess bride', 'labyrinth', 'dark crystal',
        'neverending story', 'willow', 'mad max', 'road warrior', 'dredd',
        'fifth element', 'total recall', 'robocop', 'starship troopers'],

      // Prestige/arthouse indicators
      prestige: ['criterion', 'directors cut', 'uncut', 'remastered', 'restored', 'original',
        'edition', 'documentary', 'portrait', 'story of', 'making of'],

      // Time-based preferences
      timeOfDay: {
        morning: ['2001', 'solaris', 'arrival', 'interstellar', 'her', 'moon', 'ex machina',
          'annihilation', 'blade runner', 'ghost in the shell'],
        afternoon: ['raiders', 'fury road', 'dredd', 'john wick', 'mission impossible',
          'bourne', 'kingsman', 'baby driver', 'edge of tomorrow'],
        evening: ['silence of the lambs', 'seven', 'zodiac', 'gone girl', 'prisoners',
          'shutter island', 'the thing', 'alien', 'hereditary', 'midsommar'],
        latenight: ['eraserhead', 'mulholland', 'twin peaks', 'donnie darko', 'fight club',
          'requiem', 'trainspotting', 'fear and loathing', 'bad lieutenant']
      }
    };

    // Anti-patterns (what to avoid)
    const NERD_EXCLUSIONS = [
      'hallmark', 'christmas prince', 'holiday', 'kissing booth', 'to all the boys',
      'tall girl', 'sierra burgess', 'perfect date', 'love guaranteed'
    ];

    function getTimeOfDay() {
      const hour = new Date().getHours();
      if (hour >= 6 && hour < 12) return 'morning';
      if (hour >= 12 && hour < 18) return 'afternoon';
      if (hour >= 18 && hour < 24) return 'evening';
      return 'latenight';
    }

    function getTimeFlavor() {
      const timeOfDay = getTimeOfDay();
      const flavors = {
        morning: 'Cerebral sci-fi & arthouse',
        afternoon: 'Adventure & action classics',
        evening: 'Horror, thrillers & noir',
        latenight: 'Cult classics & weird stuff'
      };
      return flavors[timeOfDay];
    }

    function updateTimeFlavor() {
      if (document.getElementById('nerd-mode').checked) {
        timeFlavorEl.textContent = `Now showing: ${getTimeFlavor()}`;
      } else {
        timeFlavorEl.textContent = '';
      }
    }

    function matchesNerdCriteria(title) {
      const nerdMode = document.getElementById('nerd-mode').checked;
      if (!nerdMode) return true;

      const titleLower = title.title.toLowerCase();
      const synopsisLower = (title.synopsis || '').toLowerCase();
      const combined = titleLower + ' ' + synopsisLower;

      // Exclusions first
      if (NERD_EXCLUSIONS.some(ex => combined.includes(ex))) {
        return false;
      }

      // Check year (80s bonus)
      const year = parseInt(title.year);
      const is80s = year >= 1980 && year <= 1989;

      // Simple keyword matching
      const hasDirector = NERD_CRITERIA.directors.some(d => combined.includes(d));
      const hasClassic = NERD_CRITERIA.classics.some(c => titleLower.includes(c));
      const hasHorror = NERD_CRITERIA.horror.some(h => titleLower.includes(h));
      const hasAdventure = NERD_CRITERIA.adventure.some(a => titleLower.includes(a));
      const hasPrestige = NERD_CRITERIA.prestige.some(p => combined.includes(p));

      // Time-of-day matching
      const timeOfDay = getTimeOfDay();
      const hasTimeMatch = NERD_CRITERIA.timeOfDay[timeOfDay].some(t => titleLower.includes(t));

      // Pass if matches any criteria (generous filtering)
      return is80s || hasDirector || hasClassic || hasHorror || hasAdventure || hasPrestige || hasTimeMatch;
    }

    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
    alphabetEl.innerHTML = letters.map(l =>
      `<button data-letter="${l}">${l}</button>`
    ).join('') + '<button class="random" id="random-btn">Choose randomnly</button>';

    alphabetEl.addEventListener('click', (e) => {
      if (e.target.tagName !== 'BUTTON') return;

      if (e.target.id === 'random-btn') {
        const showMovies = document.getElementById('filter-movie').checked;
        const showSeries = document.getElementById('filter-series').checked;

        const eligible = allTitles.filter(t =>
          ((t.type === 'movie' && showMovies) || (t.type === 'series' && showSeries)) &&
          t.netflix_id
        );

        if (eligible.length > 0) {
          const random = eligible[Math.floor(Math.random() * eligible.length)];
          window.open(`https://www.netflix.com/watch/${random.netflix_id}`, '_blank');
        }
        return;
      }

      const letter = e.target.dataset.letter;

      alphabetEl.querySelectorAll('button')
        .forEach(btn => btn.classList.remove('active'));
      e.target.classList.add('active');

      const target = document.getElementById(`letter-${letter}`);
      if (target) target.scrollIntoView({ block: 'start' });
    });

    function normalizeFromWorker(results) {
      return results.map(item => ({
        title: item.title,
        type: item.title_type === 'movie' ? 'movie' : 'series',
        year: item.title_date || item.year || 'N/A',
        netflix_id: item.netflix_id,
        img: item.img || null,
        synopsis: item.synopsis || ''
      }));
    }

    async function loadCatalog() {
      const res = await fetch(DATA_URL, { cache: 'no-store' });
      const data = await res.json();
      allTitles = normalizeFromWorker(data.results);
      document.body.classList.remove('is-loading');
      snapshotEl.textContent = `Snapshot: ${data.day} Â· ${allTitles.length} titles`;
      applyFilters();
    }

    function applyFilters() {
      const q = document.getElementById('search').value.toLowerCase();
      const showMovies = document.getElementById('filter-movie').checked;
      const showSeries = document.getElementById('filter-series').checked;

      updateTimeFlavor();

      const filtered = allTitles
        .filter(t =>
          (!q || t.title.toLowerCase().includes(q)) &&
          ((t.type === 'movie' && showMovies) || (t.type === 'series' && showSeries)) &&
          matchesNerdCriteria(t)
        )
        .sort((a, b) => a.title.localeCompare(b.title, 'en', { sensitivity: 'base' }));

      const seen = new Set();

      catalogEl.innerHTML = filtered.map(t => {
        const L = t.title[0]?.toUpperCase();
        const anchor =
          L && !seen.has(L)
            ? (seen.add(L), `id="letter-${L}"`)
            : '';

        return `
          <a class="item" ${anchor}
             href="${t.netflix_id ? `https://www.netflix.com/watch/${t.netflix_id}` : '#'}"
             target="_blank">
            ${t.img ? `
              <div class="cover-wrap">
                <img class="cover" src="${t.img}" loading="lazy">
                <div class="play-overlay">PLAY ></div>
              </div>` : ''}
            <div>
              <div class="title">${escapeHtml(t.title)}</div>
              <div class="sub">${t.year} <span class="pill">${t.type}</span></div>
              ${t.synopsis ? `<div class="synopsis">${escapeHtml(t.synopsis)}</div>` : ''}
            </div>
          </a>
        `;
      }).join('');

      document.getElementById('count').textContent = `${filtered.length} titles`;
    }

    modeCheckbox.addEventListener('change', () => {
      const on = modeCheckbox.checked;
      document.body.classList.toggle('big-mode', on);
      localStorage.setItem('viewMode', on ? 'big' : 'small');
    });

    if (localStorage.getItem('viewMode') === 'big') {
      modeCheckbox.checked = true;
      document.body.classList.add('big-mode');
    }

    // Update time flavor every minute
    setInterval(updateTimeFlavor, 60000);
    updateTimeFlavor();

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, c => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;',
        '"': '&quot;', "'": '&#39;'
      }[c]));
    }

    loadCatalog();
  </script>
</body>

</html>