<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Mike Borsare</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #000000;
      --text: #c0c0c0;
      --stamp: #888888;
      --seal: #eaffea;
      --btn-fill: color-mix(in hsl, var(--bg), var(--seal) 20%);
      --btn-text: #ffffff;
    }

    html {
      font-size: 14px;
    }

    @font-face {
      font-family: 'ComicMono';
      src: url('/fonts/ComicMono-Regular.woff') format('woff');
      font-display: swap;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-y: auto;
      background: var(--bg);
      color: var(--text);
      font-family: 'ComicMono', monospace;
    }

    .container {
      min-width: 20rem;
      max-width: 60rem;
      width: 100%;
      padding: clamp(0.75rem, 2vw, 1.25rem);
      text-align: center;
      line-height: 1.5;
    }

    .list-item {
      padding: 0.5rem 1rem;
      cursor: pointer;
      transition: color 0.2s;
    }

    .list-item:hover {
      color: var(--seal);
    }

    .ascii {
      white-space: pre;
      line-height: 1.1;
      color: var(--seal);
    }

    #clock {
      color: var(--seal);
      opacity: 0.45;
    }

    .loading {
      opacity: 0.5;
    }

    #episode-title {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: var(--seal);
    }
  </style>
</head>

<body>
  <div class="container">
    <h1 style="font-size:0.275rem;color:transparent">Mike Borsare</h1>
    <time id="clock"></time>

    <nav style="padding:1rem">
      <a href="index.html" class="ascii">Back</a>
    </nav>

    <pre class="ascii" style="font-size:0.5rem;">
  ****           *   *                                                                             
 *  *************  **                                                                              
*     *********    **                                            **                                
*     *  *         **                                            **                                
 **  *  **         **                                             **    ***    ****        ****    
    *  ***         **  ***      ***       ***  ****       ***      **    ***     ***  *   * **** * 
   **   **         ** * ***    * ***       **** **** *   * ***     **     ***     ****   **  ****  
   **   **         ***   ***  *   ***       **   ****   *   ***    **      **      **   ****       
   **   **         **     ** **    ***      **    **   **    ***   **      **      **     ***      
   **   **         **     ** ********       **    **   ********    **      **      **       ***    
    **  **         **     ** *******        **    **   *******     **      **      **         ***  
     ** *      *   **     ** **             **    **   **          **      **      *     ****  **  
      ***     *    **     ** ****    *      **    **   ****    *    ******* *******     * **** *   
       *******     **     **  *******       ***   ***   *******      *****   *****         ****    
         ***        **    **   *****         ***   ***   *****                                     
    </pre>

    <div style="padding:2rem 0">
      <h2 style="color:var(--seal)">Latest Episode</h2>
      <audio id="audio-player" controls preload="none" style="width:100%;max-width:600px"></audio>
      <p id="episode-title">Loading…</p>
    </div>

    <main>
      <h2 style="color:var(--seal);margin:2rem 0 1rem">Archive</h2>
      <ul id="episode-list" class="loading"
        style="list-style:none;padding:1rem;text-align:left;max-width:600px;margin:0 auto">
        <li class="list-item">Loading episodes…</li>
      </ul>
    </main>

    <pre class="ascii" style="font-size:0.4rem;">
██▓███   ██▀███   ██▓ ███▄ ▄███▓▓█████ 
▓██░  ██▒▓██ ▒ ██▒▓██▒▓██▒▀█▀ ██▒▓█   ▀ 
▓██░ ██▓▒▓██ ░▄█ ▒▒██▒▓██    ▓██░▒███   
▒██▄█▓▒ ▒▒██▀▀█▄  ░██░▒██    ▒██ ▒▓█  ▄ 
▒██▒ ░  ░░██▓ ▒██▒░██░▒██▒   ░██▒░▒████▒
▒▓▒░ ░  ░░ ▒▓ ░▒▓░░▓  ░ ▒░   ░  ░░░ ▒░ ░
░▒ ░        ░▒ ░ ▒░ ▒ ░░  ░      ░ ░ ░  ░
░░          ░░   ░  ▒ ░░      ░      ░    
               ░      ░         ░      ░  ░
    </pre>
  </div>

  <script>
    /* ---------- CLOCK ---------- */
    (() => {
      const clock = document.getElementById('clock');
      let t = 0;
      function update() {
        clock.textContent = new Date().toISOString().replace('T', ' ').slice(0, 23);
      }
      function pulse() {
        t += 0.02;
        clock.style.opacity = 0.35 + (Math.sin(t) + 1) * 0.15;
        requestAnimationFrame(pulse);
      }
      update();
      setInterval(update, 50);
      pulse();
    })();

    /* ---------- PODCAST (via Cloudflare Worker) ---------- */
    const WORKER_URL = 'https://the-news.mborsare.workers.dev';
    const PODCAST_NAME = 'The 7';
    const STORAGE_KEY = 'podcast_cache_taddy';

    const audioPlayer = document.getElementById('audio-player');
    const episodeTitle = document.getElementById('episode-title');
    const episodeList = document.getElementById('episode-list');

    function renderEpisodes(episodes) {
      if (!episodes?.length) return;

      episodeList.innerHTML = '';
      episodeList.classList.remove('loading');

      episodes.forEach((ep, idx) => {
        if (idx === 0 && !audioPlayer.src) {
          audioPlayer.src = ep.url;
          episodeTitle.textContent = ep.label;
        }

        const li = document.createElement('li');
        li.className = 'list-item';
        li.textContent = ep.label;
        li.onclick = () => {
          audioPlayer.src = ep.url;
          episodeTitle.textContent = ep.label;
          audioPlayer.play().catch(() => { });
        };
        episodeList.appendChild(li);
      });
    }

    async function fetchEpisodes() {
      const query = `
        query {
          getPodcastSeries(name: "${PODCAST_NAME}") {
            episodes(limitPerPage: 25) {
              uuid
              name
              audioUrl
              datePublished
            }
          }
        }
      `;

      try {
        const res = await fetch(WORKER_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query })
        });

        const json = await res.json();
        if (json.errors) throw new Error(json.errors[0].message);

        const episodes = json.data.getPodcastSeries.episodes
          .filter(ep => ep.audioUrl)
          .map(ep => ({
            label: `${new Date(ep.datePublished * 1000)
              .toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}: ${ep.name}`,
            url: ep.audioUrl
          }));

        localStorage.setItem(STORAGE_KEY, JSON.stringify(episodes));
        renderEpisodes(episodes);

      } catch (e) {
        console.error(e);
        episodeTitle.textContent = 'Error loading episodes';
      }
    }

    const cached = localStorage.getItem(STORAGE_KEY);
    if (cached) renderEpisodes(JSON.parse(cached));

    fetchEpisodes();
  </script>
</body>

</html>