<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Prime Weather</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --phosphor: #33ff33;
      --dim: #2a7f2a;
      --amber: #ffb000;
      --cyan: #00fff2;
      --red: #ff4040;
      --stamp: #2f5f2f;
    }

    @font-face {
      font-family: 'ComicMono';
      src: url('/fonts/ComicMono-Regular.woff') format('woff');
      font-display: swap;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      color: var(--phosphor);
      font-family: 'ComicMono', monospace;
      text-align: center;
      overflow: hidden;

      /* subtle CRT glow */
      text-shadow: 0 0 2px currentColor;
      -webkit-font-smoothing: none;
    }

    /* Engage state (brightness only) */
    body.go {
      color: var(--phosphor);
    }

    body.no-go {
      color: var(--dim);
    }

    /* Regime tinting (text only) */
    body.trend {
      color: var(--phosphor);
    }

    body.expansion {
      color: var(--amber);
    }

    body.cycle {
      color: var(--cyan);
    }

    body.chop {
      color: var(--dim);
    }

    body.madness {
      color: var(--red);
    }

    .container {
      max-width: 40rem;
      padding: 2rem;
    }

    #clock {
      font-size: .75rem;
      color: var(--stamp);
      margin-bottom: 2rem;
    }

    nav a {
      color: inherit;
      text-decoration: none;
    }

    .go-signal {
      font-size: 4rem;
      margin: 4rem auto;
      will-change: transform;
    }

    .score {
      font-size: 1rem;
      margin-top: 1rem;
      will-change: transform;
    }

    .meta {
      margin-top: 2rem;
      line-height: 175%;
      opacity: .85;
      will-change: transform;
    }

    .execution {
      margin-top: 2rem;
      font-size: .8rem;
      opacity: .75;
      will-change: transform;
    }

    .footer {
      margin-top: 2rem;
      font-size: .7rem;
      opacity: .6;
    }

    .ascii-prime {
      font-size: .3rem;
      margin-top: 3rem;
      opacity: .5;
    }
  </style>
</head>

<body>
  <div class="container">

    <div id="clock"></div>

    <nav style="padding: 2em 0;">
      <a href="/">Back</a>
    </nav>

    <h1 class="go-signal" id="decision">…</h1>

    <div class="score" id="grade-line"></div>

    <div class="meta">
      <div id="regime"></div>
      <div id="rplus"></div>
      <div id="range"></div>
      <div id="liquidity"></div>
    </div>

    <div class="execution" id="shape-line"></div>
    <div class="execution" id="profile-line"></div>

    <div class="footer" id="last-update"></div>

    <pre class="ascii-prime">
██▓███   ██▀███   ██▓ ███▄ ▄███▓▓█████ 
▓██░  ██▒▓██ ▒ ██▒▓██▒▓██▒▀█▀ ██▒▓█   ▀ 
▓██░ ██▓▒▓██ ░▄█ ▒▒██▒▓██    ▓██░▒███   
▒██▄█▓▒ ▒▒██▀▀█▄  ░██░▒██    ▒██ ▒▓█  ▄ 
▒██▒ ░  ░░██▓ ▒██▒░██░▒██▒   ░██▒░▒████▒
▒▓▒░ ░  ░░ ▒▓ ░▒▓░░▓  ░ ▒░   ░  ░░░ ▒░ ░
░▒ ░       ░▒ ░ ▒░ ▒ ░░  ░      ░ ░ ░  ░
░░         ░░   ░  ▒ ░░      ░      ░   
            ░      ░         ░      ░  ░
    </pre>

  </div>

  <script>
    // Clock
    (function () {
      const clock = document.getElementById('clock');
      function updateClock() {
        clock.textContent = new Date().toLocaleString();
      }
      updateClock();
      setInterval(updateClock, 1000);
    })();

    // Weather
    async function fetchWeather() {
      try {
        const res = await fetch(
          'https://weather.mborsare.workers.dev/prime/weather/ES',
          { cache: 'no-store' }
        );
        if (!res.ok) throw new Error();
        const data = await res.json();
        updateUI(data);
      } catch {
        document.body.className = 'no-go';
        document.getElementById('decision').textContent = 'ERROR';
      }
    }

    function updateUI(data) {
      const body = document.body;
      const engage = data.engage === true;

      body.className = '';
      body.classList.add(engage ? 'go' : 'no-go');
      body.classList.add(data.regime);

      document.getElementById('decision').textContent =
        engage ? 'Go' : 'Cadence';

      document.getElementById('grade-line').textContent =
        `Grade ${data.grade} · Score ${data.score}`;

      document.getElementById('regime').textContent =
        `REGIME: ${data.regime.toUpperCase()}`;

      document.getElementById('rplus').textContent =
        `R+: ${Math.round(data.rPlus * 100)}%`;

      document.getElementById('range').textContent =
        `RANGE: ${data.rangePts} pts`;

      document.getElementById('liquidity').textContent =
        `LIQUIDITY: ${data.liquidity}`;

      document.getElementById('shape-line').textContent =
        `SHAPE ${data.suggestedOrder.tp}/${data.suggestedOrder.sl}`;

      document.getElementById('profile-line').textContent =
        `PROFILE ${data.profile}`;

      document.getElementById('last-update').textContent =
        `UPDATED ${new Date(data.asOf).toLocaleTimeString()}`;
    }

    fetchWeather();
    setInterval(fetchWeather, 60000);

    // Floating motion
    function floatElement(el, {
      ampX = 3,
      ampY = 5,
      rotAmp = 0.6,
      speed = 0.0009,
      phase = Math.random() * Math.PI * 2
    } = {}) {

      function animate(time) {
        const t = time * speed + phase;

        const x = Math.sin(t) * ampX;
        const y = Math.cos(t * 0.9) * ampY;
        const r = Math.sin(t * 0.7) * rotAmp;

        el.style.transform =
          `translate3d(${x}px, ${y}px, 0) rotate(${r}deg)`;

        requestAnimationFrame(animate);
      }

      requestAnimationFrame(animate);
    }

    floatElement(document.getElementById('decision'));
    floatElement(document.getElementById('grade-line'), { ampX: 2, ampY: 4, rotAmp: 0.4, speed: 0.0007 });
    floatElement(document.querySelector('.meta'), { ampX: 4, ampY: 6, rotAmp: 0.5, speed: 0.0006 });
    floatElement(document.getElementById('shape-line'), { ampX: 2, ampY: 3, rotAmp: 0.3, speed: 0.00075 });
    floatElement(document.getElementById('profile-line'), { ampX: 2, ampY: 3, rotAmp: 0.3, speed: 0.00072 });

  </script>

</body>

</html>