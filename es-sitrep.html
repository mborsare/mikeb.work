<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Prime Weather</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --phosphor: #33ff33;
      --dim: #2a7f2a;
      --amber: #ffb000;
      --cyan: #00fff2;
      --red: #ff4040;
      --stamp: #2f5f2f;
    }

    @font-face {
      font-family: 'ComicMono';
      src: url('/fonts/ComicMono-Regular.woff') format('woff');
      font-display: swap;
    }

    body {
      margin: 0;
      background: #000;
      color: var(--phosphor);
      font-family: 'ComicMono', monospace;
      text-align: center;
    }

    /* Engage state */
    body.go {
      color: var(--phosphor);
    }

    body.no-go {
      color: var(--dim);
    }

    /* Regime tinting */
    body.trend {
      color: var(--phosphor);
    }

    body.expansion {
      color: var(--amber);
    }

    body.cycle {
      color: var(--cyan);
    }

    body.chop {
      color: var(--dim);
    }

    body.madness {
      color: var(--red);
    }

    .container {
      max-width: 40rem;
      padding: 2rem;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    #clock {
      font-size: .75rem;
      color: var(--stamp);
      margin-bottom: 2rem;
    }

    nav a {
      color: inherit;
      text-decoration: none;
    }

    .go-signal {
      font-size: 4rem;
      margin: 4rem auto;
      will-change: transform;
    }

    .score {
      font-size: 1rem;
      margin-top: 1rem;
      will-change: transform;
    }

    .meta {
      margin-top: 2rem;
      line-height: 175%;
      will-change: transform;
    }

    .execution {
      opacity: .75;
      will-change: transform;
    }

    .footer {
      margin-top: 2rem;
      font-size: .7rem;
    }

    .ascii-prime {
      font-size: .3rem;
      margin-top: 3rem;
      opacity: .5;
    }

    .jostle-btn {
      background: #000;
      color: currentColor;
      border: .2rem solid currentColor;
      border-radius: .6rem;
      padding: 1rem;
      font-family: inherit;
      cursor: pointer;
      margin: 0 auto 2rem;
      width: min(100%, 10rem);
      box-shadow: 2px 10px 0 rgba(137, 244, 98, 0.088);
    }

    .jostle-btn:active {
      transform: scale(0.95);
    }
  </style>
</head>

<body>
  <div class="container">

    <nav style="padding: 2em 0; opacity: .8;">
      <a href="/">Back</a>
    </nav>
    <div id="clock"></div>

    <p>Right now you should:</p>
    <h1 class="go-signal" id="decision">â€¦</h1>
    <button id="jostleBtn" class="jostle-btn">Fidget</button>


    <p>Current conditions:</p>

    <div class="score" id="grade-line"></div>
    <div class="meta">
      <div id="regime"></div>
      <div id="rplus"></div>
      <div id="range"></div>
      <div id="liquidity"></div>
      <div class="execution" id="shape-line"></div>
      <div class="execution" id="profile-line"></div>
    </div>




    <div class="footer" id="last-update">

    </div>

    <pre class="ascii-prime">
â–ˆâ–ˆâ–“â–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–€â–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–“ â–ˆâ–ˆâ–ˆâ–„ â–„â–ˆâ–ˆâ–ˆâ–“â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 
â–“â–ˆâ–ˆâ–‘  â–ˆâ–ˆâ–’â–“â–ˆâ–ˆ â–’ â–ˆâ–ˆâ–’â–“â–ˆâ–ˆâ–’â–“â–ˆâ–ˆâ–’â–€â–ˆâ–€ â–ˆâ–ˆâ–’â–“â–ˆ   â–€ 
â–“â–ˆâ–ˆâ–‘ â–ˆâ–ˆâ–“â–’â–“â–ˆâ–ˆ â–‘â–„â–ˆ â–’â–’â–ˆâ–ˆâ–’â–“â–ˆâ–ˆ    â–“â–ˆâ–ˆâ–‘â–’â–ˆâ–ˆâ–ˆ   
â–’â–ˆâ–ˆâ–„â–ˆâ–“â–’ â–’â–’â–ˆâ–ˆâ–€â–€â–ˆâ–„  â–‘â–ˆâ–ˆâ–‘â–’â–ˆâ–ˆ    â–’â–ˆâ–ˆ â–’â–“â–ˆ  â–„ 
â–’â–ˆâ–ˆâ–’ â–‘  â–‘â–‘â–ˆâ–ˆâ–“ â–’â–ˆâ–ˆâ–’â–‘â–ˆâ–ˆâ–‘â–’â–ˆâ–ˆâ–’   â–‘â–ˆâ–ˆâ–’â–‘â–’â–ˆâ–ˆâ–ˆâ–ˆâ–’
â–’â–“â–’â–‘ â–‘  â–‘â–‘ â–’â–“ â–‘â–’â–“â–‘â–‘â–“  â–‘ â–’â–‘   â–‘  â–‘â–‘â–‘ â–’â–‘ â–‘
â–‘â–’ â–‘       â–‘â–’ â–‘ â–’â–‘ â–’ â–‘â–‘  â–‘      â–‘ â–‘ â–‘  â–‘
â–‘â–‘         â–‘â–‘   â–‘  â–’ â–‘â–‘      â–‘      â–‘   
            â–‘      â–‘         â–‘      â–‘  â–‘
    </pre>

  </div>

  <script>
    // Clock
    (function () {
      const clock = document.getElementById('clock');
      function updateClock() {
        clock.textContent = new Date().toLocaleString();
      }
      updateClock();
      setInterval(updateClock, 1000);
    })();

    // Weather
    async function fetchWeather() {
      try {
        const res = await fetch(
          'https://weather.mborsare.workers.dev/prime/weather/ES',
          { cache: 'no-store' }
        );
        if (!res.ok) throw new Error();
        const data = await res.json();
        updateUI(data);
      } catch {
        document.body.className = 'no-go';
        document.getElementById('decision').textContent = 'ERROR';
      }
    }

    function updateUI(data) {
      const body = document.body;
      const engage = data.engage === true;

      body.className = '';
      body.classList.add(engage ? 'go' : 'no-go');
      body.classList.add(data.regime);

      document.getElementById('decision').textContent =
        engage ? 'Field trip' : 'Work on prime';

      document.getElementById('grade-line').textContent =
        `Grade ${data.grade} Â· Score ${data.score}`;

      document.getElementById('regime').textContent =
        `â˜‚ï¸ ${data.regime.toLowerCase()}`;

      document.getElementById('rplus').textContent =
        `ðŸŽ² ${Math.round(data.rPlus * 100)}%`;

      document.getElementById('range').textContent =
        `â†•ï¸ ${data.rangePts} pts`;

      document.getElementById('liquidity').textContent =
        `ðŸŒŠ ${data.liquidity}`;

      document.getElementById('shape-line').textContent =
        `ðŸ§¾ ${data.suggestedOrder.tp}/${data.suggestedOrder.sl}`;

      document.getElementById('profile-line').textContent =
        `ðŸ§¾ ${data.profile}`;

      document.getElementById('last-update').textContent =
        `Data from ${new Date(data.asOf).toLocaleTimeString()}`;
    }

    fetchWeather();
    setInterval(fetchWeather, 60000);

    // =========================
    // Floating + Elastic System
    // =========================

    let impulse = 0;
    let velocity = 0;
    const stiffness = 1;   // spring strength
    const damping = 0.85;     // friction

    function springStep() {
      // spring back toward 0
      const force = -stiffness * impulse;
      velocity += force;
      velocity *= damping;
      impulse += velocity;

      requestAnimationFrame(springStep);
    }

    springStep();

    function floatElement(el, {
      ampX = 3,
      ampY = 5,
      rotAmp = 0.6,
      speed = 0.0009,
      phase = Math.random() * Math.PI * 2
    } = {}) {

      function animate(time) {
        const t = time * speed + phase;

        const baseX = Math.sin(t) * ampX;
        const baseY = Math.cos(t * 9) * ampY;
        const baseR = Math.sin(t * 7) * rotAmp;

        // impulse energy influences all axes
        const shockX = Math.sin(t * 10) * impulse;
        const shockY = Math.cos(t * 50) * impulse;
        const shockR = Math.sin(t * 17) * impulse * 0.6;

        el.style.transform =
          `translate3d(${baseX + shockX}px, ${baseY + shockY}px, 0)
       rotate(${baseR + shockR}deg)`;

        requestAnimationFrame(animate);
      }

      requestAnimationFrame(animate);
    }

    // BIG impulse that stacks
    document.getElementById('jostleBtn').addEventListener('click', () => {
      velocity += 18; // add energy instead of resetting
    });

    // Apply float
    floatElement(document.getElementById('decision'));
    floatElement(document.getElementById('grade-line'), { ampX: 2, ampY: 4, rotAmp: 0.4, speed: 0.0007 });
    floatElement(document.querySelector('.meta'), { ampX: 4, ampY: 6, rotAmp: 0.5, speed: 0.0006 });
    floatElement(document.querySelector('.jostle-btn'), { ampX: 4, ampY: 6, rotAmp: 0.5, speed: 0.0006 });
    floatElement(document.getElementById('shape-line'), { ampX: 2, ampY: 3, rotAmp: 0.3, speed: 0.00075 });
    floatElement(document.getElementById('profile-line'), { ampX: 2, ampY: 3, rotAmp: 0.3, speed: 0.00072 });

  </script>

</body>

</html>